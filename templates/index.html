{% extends "base.html" %}
{% block content %}
<div class="text-center mb-5">
  <h1 class="display-4 fw-bold" style="color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.2);">
    <i class="fas fa-user-check float-icon"></i> Welcome to Face Attendance System
  </h1>
  <p class="lead" style="color: rgba(255,255,255,0.9);">Advanced AI-powered attendance tracking with location verification</p>
</div>

<div class="row g-4 mb-4">
  <div class="col-md-2">
    <div class="card text-center">
      <div class="card-body">
        <div class="display-4 mb-3" style="color: var(--primary);">
          <i class="fas fa-users"></i>
        </div>
        <h3 class="fw-bold">{{ persons_count }}</h3>
        <p class="text-muted mb-0">Registered</p>
      </div>
    </div>
  </div>
  <div class="col-md-2">
    <div class="card text-center">
      <div class="card-body">
        <div class="display-4 mb-3" style="color: var(--success);">
          <i class="fas fa-check-circle"></i>
        </div>
        <h3 class="fw-bold" id="todayTotal">{{ attendance_today }}</h3>
        <p class="text-muted mb-0">Present</p>
      </div>
    </div>
  </div>
  <div class="col-md-2">
    <div class="card text-center">
      <div class="card-body">
        <div class="display-4 mb-3" style="color: var(--danger);">
          <i class="fas fa-user-xmark"></i>
        </div>
        <h3 class="fw-bold" id="absentCount">{{ absent_count }}</h3>
        <p class="text-muted mb-0">Absent</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <div class="display-4 mb-3" style="color: var(--warning);">
          <i class="fas fa-clock"></i>
        </div>
        <h3 class="fw-bold" id="lateCount">0</h3>
        <p class="text-muted mb-0">Late Arrivals</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <div class="display-4 mb-3" style="color: var(--info);">
          <i class="fas fa-business-time"></i>
        </div>
        <h3 class="fw-bold" id="overtimeCount">0</h3>
        <p class="text-muted mb-0">Overtime</p>
      </div>
    </div>
  </div>
</div>

<div class="row g-4 mb-4">
  <div class="col-md-6">
    <div class="card" style="height: 400px;">
      <div class="card-body">
        <h5 class="card-title"><i class="fas fa-chart-line"></i> Weekly Attendance</h5>
        <div style="height: 320px;">
          <canvas id="weeklyChart"></canvas>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card" style="height: 400px;">
      <div class="card-body">
        <h5 class="card-title"><i class="fas fa-chart-bar"></i> Monthly Trend (Last 30 Days)</h5>
        <div style="height: 320px;">
          <canvas id="monthlyChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row g-4">
  <div class="col-md-4">
    <div class="card h-100">
      <div class="card-body text-center">
        <div class="display-1 mb-3" style="color: var(--primary);">
          <i class="fas fa-user-plus"></i>
        </div>
        <h4 class="card-title">Register Person</h4>
        <p class="text-muted">Add new employees with face recognition</p>
        <a href="{{ url_for('register_view') }}" class="btn btn-primary btn-lg w-100">
          <i class="fas fa-arrow-right"></i> Get Started
        </a>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card h-100 glow">
      <div class="card-body text-center">
        <div class="display-1 mb-3" style="color: var(--success);">
          <i class="fas fa-clock"></i>
        </div>
        <h4 class="card-title">Clock In/Out</h4>
        <p class="text-muted">Mark attendance with location verification</p>
        <a href="{{ url_for('attendance_clock_view') }}" class="btn btn-success btn-lg w-100">
          <i class="fas fa-arrow-right"></i> Start Now
        </a>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card h-100">
      <div class="card-body text-center">
        <div class="display-1 mb-3" style="color: var(--info);">
          <i class="fas fa-chart-line"></i>
        </div>
        <h4 class="card-title">View Reports</h4>
        <p class="text-muted">Analyze attendance data and insights</p>
        <a href="{{ url_for('attendance_report_view') }}" class="btn btn-info btn-lg w-100">
          <i class="fas fa-arrow-right"></i> View Reports
        </a>
      </div>
    </div>
  </div>
</div>

<div class="row mt-5">
  <div class="col-md-12">
    <div class="card">
      <div class="card-body">
        <h4 class="card-title text-center mb-4">
          <i class="fas fa-star"></i> Key Features
        </h4>
        <div class="row text-center">
          <div class="col-md-3 mb-3">
            <i class="fas fa-face-smile fa-3x mb-3" style="color: var(--primary);"></i>
            <h6>Face Recognition</h6>
            <small class="text-muted">AI-powered face detection</small>
          </div>
          <div class="col-md-3 mb-3">
            <i class="fas fa-location-dot fa-3x mb-3" style="color: var(--success);"></i>
            <h6>Geofencing</h6>
            <small class="text-muted">2m radius verification</small>
          </div>
          <div class="col-md-3 mb-3">
            <i class="fas fa-network-wired fa-3x mb-3" style="color: var(--info);"></i>
            <h6>IP Whitelist</h6>
            <small class="text-muted">Secure access control</small>
          </div>
          <div class="col-md-3 mb-3">
            <i class="fas fa-clock-rotate-left fa-3x mb-3" style="color: var(--warning);"></i>
            <h6>Real-time Tracking</h6>
            <small class="text-muted">Instant attendance logs</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
let weeklyChart, monthlyChart;

function loadAnalytics() {
  fetch('/api/analytics/dashboard')
    .then(res => res.json())
    .then(data => {
      // Update stats
      document.getElementById('todayTotal').textContent = data.today.total;
      document.getElementById('absentCount').textContent = data.today.absent;
      document.getElementById('lateCount').textContent = data.today.late;
      document.getElementById('overtimeCount').textContent = data.today.overtime;
      
      // Weekly Chart
      const weeklyCtx = document.getElementById('weeklyChart').getContext('2d');
      if (weeklyChart) weeklyChart.destroy();
      weeklyChart = new Chart(weeklyCtx, {
        type: 'bar',
        data: {
          labels: data.weekly.map(d => d.day),
          datasets: [{
            label: 'Attendance',
            data: data.weekly.map(d => d.count),
            backgroundColor: 'rgba(102, 126, 234, 0.8)',
            borderColor: 'rgba(102, 126, 234, 1)',
            borderWidth: 2,
            borderRadius: 8
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: { stepSize: 1 }
            }
          }
        }
      });
      
      // Monthly Chart
      const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
      if (monthlyChart) monthlyChart.destroy();
      monthlyChart = new Chart(monthlyCtx, {
        type: 'line',
        data: {
          labels: data.monthly.map(d => d.date),
          datasets: [{
            label: 'Attendance',
            data: data.monthly.map(d => d.count),
            backgroundColor: 'rgba(16, 185, 129, 0.2)',
            borderColor: 'rgba(16, 185, 129, 1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4,
            pointRadius: 4,
            pointHoverRadius: 6
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: { stepSize: 1 }
            }
          }
        }
      });
    })
    .catch(err => console.error('Error loading analytics:', err));
}

loadAnalytics();
setInterval(loadAnalytics, 60000); // Refresh every minute
</script>
{% endblock %}
